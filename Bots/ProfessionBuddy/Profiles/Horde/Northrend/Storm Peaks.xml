<HBProfile xsi:noNamespaceSchemaLocation="../Schemas/EchoSchema.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<!-- Original contribution by EchoTiger -->
	<Name>Storm Peaks ($ShortHash$)</Name>

	<DefaultNavType>Fly</DefaultNavType>

	<MinDurability>0.3</MinDurability>
	<MinFreeBagSlots>3</MinFreeBagSlots>

	<SellGrey>true</SellGrey>
	<SellWhite>true</SellWhite>
	<SellGreen>true</SellGreen>
	<SellBlue>true</SellBlue>
	<SellPurple>false</SellPurple>

	<MailGrey>false</MailGrey>
	<MailWhite>true</MailWhite>
	<MailGreen>true</MailGreen>
	<MailBlue>true</MailBlue>
	<MailPurple>true</MailPurple>

	<TargetElites>true</TargetElites>

	<AvoidMobs>
	</AvoidMobs>

	<Mailboxes>
	</Mailboxes>

	<Vendors>
	</Vendors>

	<Blackspots>
		<Blackspot X="6749.429" Y="-1600.49" Z="807.0364" Radius="8" /> <!-- Brunnhildar Village where bot fails to land on platform lip and gets in an endless loop -->
	</Blackspots>

	<Blacklist>
	</Blacklist>

	<QuestOrder IgnoreCheckpoints="false" >
		<!-- Check function status -->
		<Code File="RunCode" Type="Definition">
			<![CDATA[
			private static bool? profileFunctionsEnabled => (bool?)AppDomain.CurrentDomain.GetData("QuestingProfiles_FunctionsEnabled");
			private static bool IsStoreProfile(string path) => path.StartsWith("store://");
			private static string Slashify(string path) => IsStoreProfile(path) ? path.Replace(@"\", "/") : path.Replace("/", @"\");

			public __CompiledBatchClass__()
			{
				ActivateFunctions();
			}

			private static void ActivateFunctions()
			{
				if (profileFunctionsEnabled == null || profileFunctionsEnabled == false)
				{
					Bots.Professionbuddy.PBLog.Log(Colors.MediumPurple, "[Profile Message!]: ", Colors.Yellow, "Please stand by as the functions are being activated!");
					LoadProfile(@"..\..\Functions\Activate Functions.xml");
				}
			}

			private static void LoadProfile(string path)
			{
				var profile = GetNewPath(path);
				if (!IsStoreProfile(profile) && !File.Exists(profile))
				{
					Bots.Professionbuddy.PBLog.Log(Colors.MediumPurple, "[Profile Message!]: ", Colors.Yellow, "Profile does not exist.\n" + profile);
					return;
				}

				Bots.Professionbuddy.PBLog.Log(Colors.MediumPurple, "[Profile Message!]: ", Colors.Yellow, "Loading: " + profile);
				ProfileManager.LoadNew(profile, false);
			}

			private static string GetNewPath(string path)
			{
				if (IsStoreProfile(path))
					return Slashify(path);

				var currentProfile = ProfileManager.XmlLocation;
				if (IsStoreProfile(currentProfile))
					return Slashify(currentProfile + "/../" + path);

				var absolutePath = Path.Combine(Path.GetDirectoryName(currentProfile), path);
				absolutePath = Path.GetFullPath(absolutePath);
				var canonicalPath = new Uri(absolutePath).LocalPath;
				return Slashify(canonicalPath);
			}]]>
		</Code>
		<Code File="RunCode" Code="ActivateFunctions();" />
		<!-- END Check function status -->

		<If Condition="Me.IsAlliance" >
			<Code File="LoadProfile" ProfileName="..\..\Questing Autoloader.xml" />
		</If>
		<!-- RunCode Methods -->
			<Code File="RunCode">
			<![CDATA[
				Bots.Professionbuddy.PBLog.Log(System.Windows.Media.Colors.MediumPurple, "> [Profile Initialization Status] ", System.Windows.Media.Colors.CornflowerBlue, "\n     Auto-Looting	:: Enabled\n     Looting	:: Enabled\n     Game Addons	:: Disabled");
				Lua.DoString("SetCVar('AutoLootDefault', 1);");
				Lua.DoString("SetCVar('autoDismountFlying', 1);");
				CharacterSettings.Instance.LootMobs = true;
				CharacterSettings.Instance.Save();
				Logging.Write(System.Windows.Media.Colors.MediumPurple, "> [Ready to bot!]");
			]]>
			</Code>
			<Code File="RunCode" Type="Definition">
				<![CDATA[
						bool DoQuest(params uint[] questIds)
						{
							foreach (var questId in questIds)
							{
								if (HasQuest(questId) && !IsQuestCompleted(questId)) return true;
							}
							return false;
						}
						bool NeedsQuest(params uint[] questIds)
						{
							foreach (var questId in questIds)
							{
								if (!HasQuest(questId) && !IsQuestCompleted(questId)) return true;
							}
							return false;
						}
						bool NeedsBreadcrumbQuest(params uint[] questIds)
						{
							foreach (var questId in questIds)
							{
								if (IsQuestCompleted(questId)) return false;
							}
							return true;
						}
						bool QuestDone(params uint[] questIds)
						{
							foreach (var questId in questIds)
							{
								if (HasQuest(questId) && IsQuestCompleted(questId)) return true;
							}
							return false;
						}
						bool QuestFlaggedCompleted(params uint[] questIds)
						{
							foreach (var questId in questIds)
							{
								return Lua.GetReturnVal<bool>($"return IsQuestFlaggedCompleted({questId});", 0);
							}
							return false;
						}
						async Task SkipCutscene(int preWait = 3000, int postWait = 3000)
						{
					// Add detection of cutscene here.
							await Coroutine.Sleep(preWait);
					// Test and improve the working method.
							Lua.DoString("MovieFrame:StopMovie(); CinematicFrame_CancelCinematic(); StopCinematic();");
							await Coroutine.Sleep(postWait);
						}
					]]>
			</Code>
		<!-- END RunCode Methods -->

		<If Condition="!QuestDone(12882)" > <!-- Protect Relic of Ulduar from the AFK Mode sell logic -->
			<Code File="RunCode">
				<![CDATA[
					var whitelist = (List<uint>)AppDomain.CurrentDomain.GetData("QuestingProfiles_AFKModeWhitelist");
					whitelist.Add(42780);
					AppDomain.CurrentDomain.SetData("QuestingProfiles_AFKModeWhitelist", whitelist);
				]]>
			</Code>
		</If>

		<If Condition="Me.ZoneId == 3711 &amp;&amp; !IsQuestCompleted(13007)"> <!-- Don't run if we're done in Storm Peaks already -->
			<Code File="InteractWith" MobId="28574" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" X="5504.018" Y="4746.764" Z="-194.4334" />
			<Code File="Misc\RunLua" Lua="GetNumRoutes(24); TakeTaxiNode(24);" />
		</If>

		<PickUp QuestName="Clean Up" QuestId="12818" GiverName="Jeer Sparksocket" GiverId="29431" X="6100.173" Y="-1072.726" Z="403.9145" />

		<If Condition="!IsQuestCompleted(12843)" > <!-- Don't set hearth to here if we're already done with this quest hub -->
			<Code File="SetHearthstone" MobId="29904" AreaId="4418" X="6122.536" Y="-1079.142" Z="402.5634" />
		</If>

		<PickUp QuestName="They Took Our Men!" QuestId="12843" GiverName="Gretchen Fizzlespark" GiverId="29473" X="6115.325" Y="-1084.119" Z="402.6874" />
		<PickUp QuestName="Equipment Recovery" QuestId="12844" GiverName="Gretchen Fizzlespark" GiverId="29473" X="6115.325" Y="-1084.119" Z="402.6874" />
		<PickUp QuestName="Reclaimed Rations" QuestId="12827" GiverName="Ricket" GiverId="29428" X="6150.011" Y="-1069.788" Z="402.6683" />
		<PickUp QuestName="Expression of Gratitude" QuestId="12836" GiverName="Ricket" GiverId="29428" X="6150.011" Y="-1069.788" Z="402.6683" />

		<Code File="InteractWith" MobIds="191531, 191532, 191533, 191534, 191535, 191536, 191537" CollectionDistance="200" PreInteractMountStrategy="Dismount" InteractByLooting="true" QuestId="12818" QuestObjectiveIndex="1" >
			<HuntingGrounds>
				<Hotspot X="6099.536" Y="-928.5246" Z="386.8707" />
				<Hotspot X="6188.743" Y="-923.0375" Z="395.5251" />
				<Hotspot X="6023.216" Y="-865.5541" Z="357.703" />
			</HuntingGrounds>
		</Code>

		<Code File="KillUntilComplete" MobId="30003" QuestId="12836" X="6135.377" Y="-331.2336" Z="436.3404" />

		<Code File="InteractWith" MobId="191843" CollectionDistance="200" PreInteractMountStrategy="Dismount" QuestId="12827" QuestObjectiveIndex="1" >
			<HuntingGrounds>
				<Hotspot X="6145.675" Y="-333.6937" Z="436.3389" />
				<Hotspot X="6126.579" Y="-429.226" Z="413.4729" />
				<Hotspot X="6250.854" Y="-648.3079" Z="416.9152" />
			</HuntingGrounds>
		</Code>

		<TurnIn QuestName="Clean Up" QuestId="12818" TurnInName="Jeer Sparksocket" TurnInId="29431" X="6100.652" Y="-1073.395" Z="403.8179" />
		<!-- <PickUp QuestName="Just Around the Corner" QuestId="12819" GiverName="Jeer Sparksocket" GiverId="29431" X="6100.652" Y="-1073.395" Z="403.8179" /> Very doable, but myeh -->
		<TurnIn QuestName="Reclaimed Rations" QuestId="12827" TurnInName="Ricket" TurnInId="29428" X="6148.677" Y="-1069.168" Z="402.6856" />
		<TurnIn QuestName="Expression of Gratitude" QuestId="12836" TurnInName="Ricket" TurnInId="29428" X="6148.677" Y="-1069.168" Z="402.6856" />
		<RecheckCheckpoints />
		<PickUp QuestName="Ample Inspiration" QuestId="12828" GiverName="Ricket" GiverId="29428" X="6149.694" Y="-1070.935" Z="402.6509" />
		<PickUp QuestName="Moving In" QuestId="12829" GiverName="Tore Rumblewrench" GiverId="29430" X="6401.117" Y="-1123.211" Z="425.9408" />
		<PickUp QuestName="Ore Repossession" QuestId="12830" GiverName="Tore Rumblewrench" GiverId="29430" X="6401.117" Y="-1123.211" Z="425.9408" />

		<While Condition="DoQuest(12828)" >
			<Code File="InteractWith" MobId="191553" GossipOptions="1" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" QuestId="12828" TerminateWhen="Me.HasAura(54584)" X="6401.377" Y="-1119.095" Z="425.6564" />
			<Code File="InteractWith" WaitTime="5000" InteractByUsingItemId="40686" CollectionDistance="200" PreInteractMountStrategy="Dismount" QuestId="12828" X="6222.068" Y="-735.6066" Z="409.4177" TerminateWhen="!HasItem(40686) || Object(192694) != null || Object(191567) != null || Object(192693) != null" >
				<PursuitList> <!-- This can be removed once MobState="Alive" is fixed.  Dead mammoths are showing up as alive currently. -->
					<PursueUnit Id="29402" PursueWhen="!UNIT.HasAura(29266)" />
				</PursuitList>
			</Code>
			<Code File="InteractWith" MobIds="192694, 192693, 191567" WaitForNpcs="false" InteractByLooting="true" CollectionDistance="200" PreInteractMountStrategy="Dismount" QuestId="12828" />
		</While>

		<Code File="InteractWith" MobId="191568" CollectionDistance="200" PreInteractMountStrategy="Dismount" InteractByLooting="true" QuestId="12844" QuestObjectiveIndex="1" >
			<HuntingGrounds>
				<Hotspot X="6752.271" Y="-1018.504" Z="766.3334" />
				<Hotspot X="6826.409" Y="-1135.128" Z="794.2008" />
				<Hotspot X="6855.442" Y="-979.8727" Z="789.1761" />
			</HuntingGrounds>
		</Code>

		<While Condition="DoQuest(12843)" >
			<!-- NOTE: <QuestKey> -->
			<Code File="KillUntilComplete" MobIds="29323, 29331" QuestId="12843" TerminateWhen="GetItemCount(40641) &gt;= 5" >
				<HuntingGrounds>
					<Hotspot X="6752.271" Y="-1018.504" Z="766.3334" />
					<Hotspot X="6826.409" Y="-1135.128" Z="794.2008" />
					<Hotspot X="6855.442" Y="-979.8727" Z="789.1761" />
				</HuntingGrounds>
			</Code>

			<Code File="InteractWith" MobIds="191544, 191545" CollectionDistance="200" Range="4" PreInteractMountStrategy="Dismount" QuestId="12843" QuestObjectiveIndex="1" TerminateWhen="!HasItem(40641)" >
				<HuntingGrounds>
					<Hotspot X="6752.271" Y="-1018.504" Z="766.3334" />
					<Hotspot X="6826.409" Y="-1135.128" Z="794.2008" />
					<Hotspot X="6855.442" Y="-979.8727" Z="789.1761" />
				</HuntingGrounds>
			</Code>
		</While>

		<If Condition="QuestDone(12843) &amp;&amp; Me.HearthstoneAreaId == 4418 &amp;&amp; Object(191545) != null" >
			<Code File="UseHearthstone" WaitForCD="false" />
		</If>

		<TurnIn QuestName="They Took Our Men!" QuestId="12843" TurnInName="Gretchen Fizzlespark" TurnInId="29473" X="6116.461" Y="-1083.938" Z="402.6032" />
		<PickUp QuestName="Leave No Goblin Behind" QuestId="12846" GiverName="Gretchen Fizzlespark" GiverId="29473" X="6116.461" Y="-1083.938" Z="402.6032" />
		<TurnIn QuestName="Equipment Recovery" QuestId="12844" TurnInName="Gretchen Fizzlespark" TurnInId="29473" X="6116.461" Y="-1083.938" Z="402.6032" />
		<TurnIn QuestName="Ample Inspiration" QuestId="12828" TurnInName="Ricket" TurnInId="29428" X="6149.112" Y="-1070.179" Z="402.6634" />
		<RecheckCheckpoints />

		<While Condition="DoQuest(12829, 12830)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="6468.969" Y="-1034.916" Z="433.8634" />
				<MoveTo Nav="Run" X="6537.376" Y="-1021.174" Z="433.1256" />
			</If>
			<Code File="KillUntilComplete" MovementBy="NavigatorOnly" TerminateWhen="!DoQuest(12829, 12830)" >
				<HuntingGrounds>
					<Hotspot X="6572.864" Y="-1023.517" Z="433.0027" />
					<Hotspot X="6622.891" Y="-1284.322" Z="394.4758" />
				</HuntingGrounds>
				<PursuitList>
					<PursueUnit Id="29413" PursueWhen="DoQuest(12830)" />
					<PursueUnit Id="29412" PursueWhen="DoQuest(12829)" />
					<PursueUnit Id="29411" PursueWhen="DoQuest(12829)" />
				</PursuitList>
			</Code>
		</While>

		<TurnIn QuestName="Moving In" QuestId="12829" TurnInName="Tore Rumblewrench" TurnInId="29430" X="6400.499" Y="-1121.628" Z="425.716" />
		<TurnIn QuestName="Ore Repossession" QuestId="12830" TurnInName="Tore Rumblewrench" TurnInId="29430" X="6400.499" Y="-1121.628" Z="425.716" />

		<If Condition="QuestDone(12846)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="6897.244" Y="-1131.556" Z="801.2968" />
				<MoveTo Nav="Run" X="6928.458" Y="-1209.567" Z="808.0966" />
			</If>
			<TurnIn QuestName="Leave No Goblin Behind" QuestId="12846" TurnInName="Lok&apos;lira the Crone" TurnInId="29481" X="6930.933" Y="-1205.946" Z="808.0836" />
		</If>

		<PickUp QuestName="The Crone&apos;s Bargain" QuestId="12841" GiverName="Lok&apos;lira the Crone" GiverId="29481" X="6931.239" Y="-1206.44" Z="808.1085" />
		<Code File="KillUntilComplete" MobId="29518" QuestId="12841" >
			<HuntingGrounds>
				<Hotspot X="6932.478" Y="-1347.447" Z="831.1266" />
				<Hotspot X="6981.004" Y="-1298.517" Z="819.8541" />
			</HuntingGrounds>
		</Code>
		<TurnIn QuestName="The Crone&apos;s Bargain" QuestId="12841" TurnInName="Lok&apos;lira the Crone" TurnInId="29481" X="6931.012" Y="-1206.097" Z="808.0908" />

		<PickUp QuestName="Mildred the Cruel" QuestId="12905" GiverName="Lok&apos;lira the Crone" GiverId="29481" X="6931.012" Y="-1206.097" Z="808.0908" />
		<TurnIn QuestName="Mildred the Cruel" QuestId="12905" TurnInName="Mildred the Cruel" TurnInId="29885" X="6929.321" Y="-1320.8" Z="831.2205" />

		<PickUp QuestName="Discipline" QuestId="12906" GiverName="Mildred the Cruel" GiverId="29885" X="6929.321" Y="-1320.8" Z="831.2205" />
		<Code File="InteractWith" MobId="30146" Range="2" CollectionDistance="200" InteractByUsingItemId="42837" QuestId="12906" QuestObjectiveIndex="1" >
			<HuntingGrounds>
				<Hotspot X="6876.274" Y="-1291.496" Z="818.6411" />
				<Hotspot X="6987.678" Y="-1299.496" Z="819.2332" />
			</HuntingGrounds>
		</Code>
		<TurnIn QuestName="Discipline" QuestId="12906" TurnInName="Mildred the Cruel" TurnInId="29885" X="6929.248" Y="-1320.391" Z="831.2234" />
		<RecheckCheckpoints />

		<PickUp QuestName="Examples to be Made" QuestId="12907" GiverName="Mildred the Cruel" GiverId="29885" X="6929.248" Y="-1320.391" Z="831.2234" />
		<Code File="KillUntilComplete" MobId="30147" QuestId="12907" X="6932.816" Y="-1384.643" Z="830.2338" />
		<TurnIn QuestName="Examples to be Made" QuestId="12907" TurnInName="Mildred the Cruel" TurnInId="29885" X="6930.162" Y="-1320.425" Z="831.2233" />

		<PickUp QuestName="A Certain Prisoner" QuestId="12908" GiverName="Mildred the Cruel" GiverId="29885" X="6930.162" Y="-1320.425" Z="831.2233" />
		<TurnIn QuestName="A Certain Prisoner" QuestId="12908" TurnInName="Lok&apos;lira the Crone" TurnInId="29481" X="6930.814" Y="-1207.037" Z="808.1113" />
		<PickUp QuestName="A Change of Scenery" QuestId="12921" GiverName="Lok&apos;lira the Crone" GiverId="29481" X="6930.814" Y="-1207.037" Z="808.1113" />
		<If Condition="QuestDone(12921) &amp;&amp; !Me.IsIndoors" >
			<MoveTo X="6925.297" Y="-1536.112" Z="835.7397" />
		</If>
		<TurnIn Nav="Run" QuestName="A Change of Scenery" QuestId="12921" TurnInName="Lok&apos;lira the Crone" TurnInId="29975" X="6925.297" Y="-1536.112" Z="835.7397" />

		<PickUp QuestName="Is That Your Goblin?" QuestId="12969" GiverName="Lok&apos;lira the Crone" GiverId="29975" X="6925.297" Y="-1536.112" Z="835.7397" />
		<Code File="InteractWith" MobId="30154" GossipOptions="1" NonCompeteDistance="0" QuestId="12969" QuestObjectiveIndex="1" X="6893.164" Y="-1585.157" Z="820.6569" />
		<TurnIn QuestName="Is That Your Goblin?" QuestId="12969" TurnInName="Lok&apos;lira the Crone" TurnInId="29975" X="6919.604" Y="-1538.371" Z="834.9908" />

		<PickUp QuestName="The Hyldsmeet" QuestId="12970" GiverName="Lok&apos;lira the Crone" GiverId="29975" X="6919.604" Y="-1538.371" Z="834.9908" />
		<Code File="InteractWith" MobId="29975" GossipOptions="1,1,1,1" NonCompeteDistance="0" QuestId="12970" QuestObjectiveIndex="1" X="6920.721" Y="-1536.483" Z="835.5316" />
		<TurnIn QuestName="The Hyldsmeet" QuestId="12970" TurnInName="Lok&apos;lira the Crone" TurnInId="29975" X="6920.386" Y="-1538.903" Z="834.8568" />

		<PickUp QuestName="Taking on All Challengers" QuestId="12971" GiverName="Lok&apos;lira the Crone" GiverId="29975" X="6920.386" Y="-1538.903" Z="834.8568" />
		<Code File="InteractWith" MobId="30012" GossipOptions="1" WaitTime="2000" CollectionDistance="200" PreInteractMountStrategy="Dismount" QuestId="12971" QuestObjectiveIndex="1" X="7022.092" Y="-1747.239" Z="819.4403" />
		<TurnIn QuestName="Taking on All Challengers" QuestId="12971" TurnInName="Lok&apos;lira the Crone" TurnInId="29975" X="6922.154" Y="-1537.832" Z="835.2129" />
		<RecheckCheckpoints />

		<PickUp QuestName="You&apos;ll Need a Bear" QuestId="12972" GiverName="Lok&apos;lira the Crone" GiverId="29975" X="6922.154" Y="-1537.832" Z="835.2129" />
		<PickUp QuestName="Off With Their Black Wings" QuestId="12942" GiverName="Iva the Vengeful" GiverId="29997" X="6777.942" Y="-1597.203" Z="820.4276" />
		<PickUp QuestName="Yulda&apos;s Folly" QuestId="12968" GiverName="Iva the Vengeful" GiverId="29997" X="6777.942" Y="-1597.203" Z="820.4276" />
		<PickUp QuestName="Aberrations" QuestId="12925" GiverName="Thyra Kvinnshal" GiverId="30041" X="6779.287" Y="-1601.469" Z="820.5189" />
		<TurnIn Nav="Run" QuestName="You&apos;ll Need a Bear" QuestId="12972" TurnInName="Brijana" TurnInId="29592" X="7080.486" Y="-1941.49" Z="772.1866" />

		<PickUp QuestName="Going Bearback" QuestId="12851" GiverName="Brijana" GiverId="29592" X="7080.486" Y="-1941.49" Z="772.1866" />
		<While Condition="DoQuest(12851)" >
			<Code File="InteractWith" MobId="29598" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" QuestId="12851" X="7081.563" Y="-1938.649" Z="772.2943" TerminateWhen="Me.InVehicle" />
			<DisableBehavior Name="All" />
			<Code File="RunCode"><![CDATA[
				WoWUnit attackPoi = null;
				while (DoQuest(12851) && Me.InVehicle)
				{

					if (!IsObjectiveComplete(1, 12851) && !IsObjectiveComplete(2, 12851))	
						attackPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => (x.Entry == 29358 || x.Entry == 29351) && x.IsAlive && !x.HasAura(54683) && x.DistanceSqr < 79f*79f);
					else if (!IsObjectiveComplete(1, 12851))
						attackPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 29358 && x.IsAlive && !x.HasAura(54683) && x.DistanceSqr < 79f*79f);
					else if (!IsObjectiveComplete(2, 12851))
						attackPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 29351 && x.IsAlive && !x.HasAura(54683) && x.DistanceSqr < 79f*79f);

					if (attackPoi == null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(2) == 0;", 0))
						Lua.DoString("CastPetAction(2);");

					if (attackPoi != null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(1) == 0;", 0))
					{
						Lua.DoString("CastPetAction(1);");
						SpellManager.ClickRemoteLocation(attackPoi.Location);
					}

					attackPoi = null;
					await Coroutine.Yield();
				}
			]]> <!-- HB-API is returning incorrect values, so using Lua.-->
			</Code>
			<Code File="WaitTimer" WaitTime="120000" TerminateWhen="!Me.InVehicle" />
			<EnableBehavior Name="All" />
		</While>
		<TurnIn QuestName="Going Bearback" QuestId="12851" TurnInName="Brijana" TurnInId="29592" X="7080.104" Y="-1943.214" Z="771.9979" />

		<PickUp QuestName="Cold Hearted" QuestId="12856" GiverName="Brijana" GiverId="29592" X="7080.104" Y="-1943.214" Z="771.9979" />
		<While Condition="DoQuest(12856)" >
			<Code File="InteractWith" MobId="29708" CollectionDistance="300" QuestId="12856" X="7310.845" Y="-2756.393" Z="878.2722" TerminateWhen="Me.InVehicle" />
			<DisableBehavior Name="All" />
			<Code File="RunCode"><![CDATA[
				WoWUnit prisonerPoi = null;
				int prisonerCount = 0;
				while (DoQuest(12856) && Me.InVehicle)
				{
					if (prisonerCount < 3)
					{
						if (prisonerPoi == null)
							prisonerPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 29639 && (x.HasAura(55045) || x.HasAura(54894)));

						if (prisonerPoi != null)
						{
							if (prisonerPoi.DistanceSqr > 49f*49f)
							{
								TreeRoot.StatusText = "Moving to free a prisoner.";
								WoWMovement.ClickToMove(prisonerPoi.Location);
							}
							if (prisonerPoi.DistanceSqr <= 49f*49f && prisonerPoi.InLineOfSight)
							{
								TreeRoot.StatusText = "Freeing a prisoner.";
								await CommonCoroutines.StopMoving();
								prisonerPoi.Target();
								Lua.DoString("CastPetAction(1);");
								if (!prisonerPoi.HasAura(55045) && !prisonerPoi.HasAura(54894))
								{
									prisonerCount ++;
									prisonerPoi = null;
								}
							}
						}
					}
					if (prisonerCount >= 3)
					{
						TreeRoot.StatusText = "Returning home.";
						if (Me.Y < -2569)
							WoWMovement.ClickToMove(new Vector3(7306.258f, -2569.274f, 892.428f));

						await Coroutine.Wait(TimeSpan.FromSeconds(60), () => !Me.InVehicle);
						prisonerCount = 0;
					}
					await Coroutine.Yield();
				}
			]]> <!-- HB-API is returning incorrect values, so using Lua.-->
			</Code>
			<EnableBehavior Name="All" />
		</While>
		<TurnIn QuestName="Cold Hearted" QuestId="12856" TurnInName="Brijana" TurnInId="29592" X="7082.423" Y="-1941.857" Z="772.5594" />
		<RecheckCheckpoints />

		<PickUp QuestName="Deemed Worthy" QuestId="13063" GiverName="Brijana" GiverId="29592" X="7082.423" Y="-1941.857" Z="772.5594" />
		<TurnIn QuestName="Deemed Worthy" QuestId="13063" TurnInName="Astrid Bjornrittar" TurnInId="29839" X="6795.356" Y="-1697.132" Z="821.3065" />

		<PickUp QuestName="Making a Harness" QuestId="12900" GiverName="Astrid Bjornrittar" GiverId="29839" X="6795.356" Y="-1697.132" Z="821.3065" />
		<Code File="KillUntilComplete" MobId="29875" QuestId="12900" >
			<HuntingGrounds>
				<Hotspot X="6677.05" Y="-1593.369" Z="650.926" />
				<Hotspot X="6593.877" Y="-1518.834" Z="656.6565" />
			</HuntingGrounds>
		</Code>
		<TurnIn QuestName="Making a Harness" QuestId="12900" TurnInName="Astrid Bjornrittar" TurnInId="29839" X="6794.919" Y="-1696.828" Z="821.2875" />

		<PickUp QuestName="The Last of Her Kind" QuestId="12983" GiverName="Astrid Bjornrittar" GiverId="29839" X="6794.919" Y="-1696.828" Z="821.2875" />
		<PickUp QuestName="The Slithering Darkness" QuestId="12989" GiverName="Astrid Bjornrittar" GiverId="29839" X="6794.919" Y="-1696.828" Z="821.2875" />

		<While Condition="DoQuest(12983, 12989)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="7153.602" Y="-2135.321" Z="762.0702" />
			</If>
			<Code File="KillUntilComplete" MobId="29605" MovementBy="NavigatorOnly" QuestId="12989" >
				<HuntingGrounds>
					<Hotspot X="7308.447" Y="-2016.385" Z="764.2152" />
					<Hotspot X="7193.143" Y="-2085.655" Z="765.4305" />
				</HuntingGrounds>
			</Code>
			<Code File="InteractWith" MobId="29563" MovementBy="NavigatorOnly" QuestId="12983" X="7332.689" Y="-2065.967" Z="765.309" />
			<Code File="WaitTimer" WaitTime="80000" QuestId="12983" />
		</While>

		<TurnIn QuestName="The Last of Her Kind" QuestId="12983" TurnInName="Astrid Bjornrittar" TurnInId="29839" X="6794.907" Y="-1696.874" Z="821.2857" />
		<PickUp QuestName="The Warm-Up " QuestId="12996" GiverName="Astrid Bjornrittar" GiverId="29839" X="6794.907" Y="-1696.874" Z="821.2857" />
		<TurnIn QuestName="The Slithering Darkness" QuestId="12989" TurnInName="Astrid Bjornrittar" TurnInId="29839" X="6794.907" Y="-1696.874" Z="821.2857" />

		<While Condition="DoQuest(12996)" >
			<MoveTo X="6999.174" Y="-1767.008" Z="820.0167" />
			<Code File="UseItem" ItemId="42481" TerminateWhen="Me.InVehicle" />
			<DisableBehavior Name="All" />
			<Code File="RunCode"><![CDATA[
					WoWUnit kirgaraakPoi = ObjectManager.GetObjectsOfType<WoWUnit>().FirstOrDefault(x => x.Entry == 29352 && x.IsAlive);
					while (DoQuest(12996) && Me.InVehicle && kirgaraakPoi != null)
					{
						if (Me.CurrentTarget != kirgaraakPoi)
							kirgaraakPoi.Target();

						if (kirgaraakPoi.DistanceSqr > 5f*5f)
							WoWMovement.ClickToMove(kirgaraakPoi.Location);

						if (kirgaraakPoi.DistanceSqr <= 5f*5f)
						{
							Me.SetFacing(kirgaraakPoi);

							if (kirgaraakPoi != null && kirgaraakPoi.DistanceSqr > 8f*8f && Lua.GetReturnVal<bool>("return GetPetActionCooldown(6) == 0;", 0))
								Lua.DoString("CastPetAction(6);");

							if (kirgaraakPoi != null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(4) == 0;", 0))
								Lua.DoString("CastPetAction(4);");

							if (kirgaraakPoi != null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(5) == 0;", 0))
								Lua.DoString("CastPetAction(5);");
						}

						await Coroutine.Yield();
					}
				]]>
			</Code>
			<EnableBehavior Name="All" />
			<While Condition="Me.InVehicle" >
				<Code File="EjectVeh" />
			</While>
		</While>

		<TurnIn QuestName="The Warm-Up " QuestId="12996" TurnInName="Astrid Bjornrittar" TurnInId="29839" X="6796.038" Y="-1697.186" Z="821.3334" />
		<RecheckCheckpoints />

		<PickUp QuestName="Into the Pit" QuestId="12997" GiverName="Astrid Bjornrittar" GiverId="29839" X="6796.038" Y="-1697.186" Z="821.3334" />
		<While Condition="DoQuest(12997)" >
			<MoveTo X="6957.627" Y="-1658.275" Z="810.8226" />
			<Code File="UseItem" ItemId="42499" TerminateWhen="Me.InVehicle" />
			<DisableBehavior Name="All" />
			<Code File="RunCode"><![CDATA[
				WoWUnit hyldsmeetUnitPoi = null;
				while (DoQuest(12997) && Me.InVehicle)
				{
					if (hyldsmeetUnitPoi == null || hyldsmeetUnitPoi.IsDead)
						hyldsmeetUnitPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 30174 && x.IsAlive);

					if (hyldsmeetUnitPoi != null && hyldsmeetUnitPoi.IsAlive)
					{
						if (Me.CurrentTarget != hyldsmeetUnitPoi)
							hyldsmeetUnitPoi.Target();

						if (hyldsmeetUnitPoi.DistanceSqr > 10f*10f)
							WoWMovement.ClickToMove(hyldsmeetUnitPoi.Location);

						if (hyldsmeetUnitPoi.DistanceSqr <= 10f*10f)
						{
							Me.SetFacing(hyldsmeetUnitPoi);
							await CommonCoroutines.StopMoving();

							if (hyldsmeetUnitPoi != null && hyldsmeetUnitPoi.DistanceSqr > 8f*8f && Lua.GetReturnVal<bool>("return GetPetActionCooldown(6) == 0;", 0))
								Lua.DoString("CastPetAction(6);");

							if (hyldsmeetUnitPoi != null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(4) == 0;", 0))
								Lua.DoString("CastPetAction(4);");

							if (hyldsmeetUnitPoi != null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(5) == 0;", 0))
								Lua.DoString("CastPetAction(5);");
						}
					}
					await Coroutine.Yield();
				}
				]]>
			</Code>
			<EnableBehavior Name="All" />
			<Code File="EjectVeh" />
		</While>
		<TurnIn QuestName="Into the Pit" QuestId="12997" TurnInName="Astrid Bjornrittar" TurnInId="29839" X="6794.889" Y="-1696.899" Z="821.286" />

		<PickUp QuestName="Prepare for Glory" QuestId="13061" GiverName="Astrid Bjornrittar" GiverId="29839" X="6794.889" Y="-1696.899" Z="821.286" />
		<TurnIn QuestName="Prepare for Glory" QuestId="13061" TurnInName="Lok&apos;lira the Crone" TurnInId="29975" X="6921.114" Y="-1537.989" Z="835.1387" />
		<PickUp QuestName="Lok&apos;lira&apos;s Parting Gift" QuestId="13062" GiverName="Lok&apos;lira the Crone" GiverId="29975" X="6921.114" Y="-1537.989" Z="835.1387" />
		<TurnIn QuestName="Lok&apos;lira&apos;s Parting Gift" QuestId="13062" TurnInName="Gretta the Arbiter" TurnInId="29796" X="7085.76" Y="-1776.738" Z="820.9234" />

		 <!--<If Condition="!IsQuestCompleted(13424)" > This is a daily, so we only want to do it if the quest after this one isn't complete 
			<PickUp QuestName="Back to the Pit" QuestId="13424" GiverName="Gretta the Arbiter" GiverId="29796" X="7085.76" Y="-1776.738" Z="820.9234" />
			<MoveTo X="6957.627" Y="-1658.275" Z="810.8226" />
			<Code File="UseItem" ItemId="42499" TerminateWhen="Me.InVehicle" />
			<DisableBehavior Name="All" />
			<Code File="RunCode"><![CDATA[
				WoWUnit hyldsmeetUnitPoi = null;
				while (DoQuest(13424) && Me.InVehicle)
				{
					if (hyldsmeetUnitPoi == null || hyldsmeetUnitPoi.IsDead)
						hyldsmeetUnitPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 30174 && x.IsAlive);

					if (hyldsmeetUnitPoi != null && hyldsmeetUnitPoi.IsAlive)
					{
						if (Me.CurrentTarget != hyldsmeetUnitPoi)
							hyldsmeetUnitPoi.Target();

						if (hyldsmeetUnitPoi.DistanceSqr > 10f*10f)
							WoWMovement.ClickToMove(hyldsmeetUnitPoi.Location);

						if (hyldsmeetUnitPoi.DistanceSqr <= 10f*10f)
						{
							Me.SetFacing(hyldsmeetUnitPoi);
							await CommonCoroutines.StopMoving();

							if (hyldsmeetUnitPoi != null && hyldsmeetUnitPoi.DistanceSqr > 8f*8f && Lua.GetReturnVal<bool>("return GetPetActionCooldown(6) == 0;", 0))
								Lua.DoString("CastPetAction(6);");

							if (hyldsmeetUnitPoi != null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(4) == 0;", 0))
								Lua.DoString("CastPetAction(4);");

							if (hyldsmeetUnitPoi != null && Lua.GetReturnVal<bool>("return GetPetActionCooldown(5) == 0;", 0))
								Lua.DoString("CastPetAction(5);");
						}
					}
					await Coroutine.Yield();
				}
				]]>
			</Code>
			<EnableBehavior Name="All" />
			<Code File="EjectVeh" />
		</If>
		<If Condition="QuestDone(29796)" >
			<TurnIn QuestName="Back to the Pit" QuestId="13424" TurnInName="Gretta the Arbiter" TurnInId="29796" X="7085.82" Y="-1776.649" Z="820.924" />
			<Code File="UseItem" ItemId="44751" />
		</If> -->


		<PickUp QuestName="The Drakkensryd" QuestId="12886" GiverName="Gretta the Arbiter" GiverId="29796" X="7085.47" Y="-1775.094" Z="828.3397" />
		<While Condition="DoQuest(12886)" >
			<Code File="RunCode"><![CDATA[ TreeHooks.Instance.InsertHook("Questbot_Profile", 0, _drakensyrdHook ?? (_drakensyrdHook = new  CommonBehaviors.Actions.ActionRunCoroutine(ctx => DrakensyrdTask()))); ]]></Code>
			<Code File="RunCode" Type="Definition" ><![CDATA[
				private Styx.TreeSharp.Composite _drakensyrdHook;
				private WoWUnit drakeriderPoi = null;
				private WoWUnit drakeriderDrakePoi = null;
				private WoWItem harpoonPoi => Me.BagItems.FirstOrDefault(x => x.Entry == 41058);

				private async Task<bool> DrakensyrdTask()
				{
					if (!Me.InVehicle) return false;
					drakeriderPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 29694 && x.DistanceSqr <= 99f*99f && x.IsAlive);
					if (drakeriderPoi == null) return false;
					if (drakeriderPoi.DistanceSqr < 10f*10f) return false;

					if (drakeriderPoi.DistanceSqr >= 10f*10f)
					{
						drakeriderDrakePoi = ObjectManager.GetObjectsOfType<WoWUnit>().FirstOrDefault(x => x.Entry == 29625 && x.Location.DistanceSquared(drakeriderPoi.Location) < 10f*10f);
						if (drakeriderDrakePoi == null) return false;
						drakeriderDrakePoi.Target();
						harpoonPoi.Use();
						await Coroutine.Wait(10000, () => !Me.IsFalling);
					}
					return true;
				}
				]]>
			</Code>
			<While Condition="DoQuest(12886)" >
				<Code File="InteractWith" MobId="29796" GossipOptions="1" NonCompeteDistance="0" QuestId="12886" X="7085.47" Y="-1775.094" Z="828.3397" TerminateWhen="Me.InVehicle" />
				<Code File="KillUntilComplete" MobId="41058" MovementBy="None" QuestId="12886" TerminateWhen="drakeriderPoi == null || drakeriderPoi.IsDead" />
				<Code File="WaitTimer" WaitTime="30000" TerminateWhen="drakeriderPoi != null || !Me.InVehicle" />
			</While>
		</While>
		<If Condition="QuestDone(12886)" >
			<Code File="RunCode"><![CDATA[ TreeHooks.Instance.RemoveHook("Questbot_Profile", _drakensyrdHook); ]]></Code>
			<Code File="RunCode"><![CDATA[
					WoWUnit ornamentPoi = null;
					while (Me.InVehicle)
					{
						if (ornamentPoi == null)
							ornamentPoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderBy(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 29754 && x.DistanceSqr <= 99f*99f);
						if (ornamentPoi != null)
						{
							ornamentPoi.Target();
							harpoonPoi.Use();
							await Coroutine.Wait(10000, () => !Me.IsFalling && !Me.InVehicle);
						}
						else
						{
							drakeriderDrakePoi = ObjectManager.GetObjectsOfType<WoWUnit>().OrderByDescending(x => x.DistanceSqr).FirstOrDefault(x => x.Entry == 29625 && x.DistanceSqr <= 99f*99f && x.Z > Me.Z);
							if (drakeriderDrakePoi != null)
							{
								drakeriderDrakePoi.Target();
								Me.BagItems.FirstOrDefault(x => x.Entry == 41058).Use();
								await Coroutine.Wait(10000, () => !Me.IsFalling);
							}
						}
						await Coroutine.Yield();
					}
				]]>
			</Code>
			<TurnIn QuestName="The Drakkensryd" QuestId="12886" TurnInName="Thorim" TurnInId="29445" X="7442.358" Y="-533.6326" Z="1896.851" />
		</If>

		<PickUp QuestName="Sibling Rivalry" QuestId="13064" GiverName="Thorim" GiverId="29445" X="7443.989" Y="-535.682" Z="1896.85" />
		<Code File="InteractWith" MobId="29445" GossipOptions="1,1,1" NonCompeteDistance="0" QuestId="13064" QuestObjectiveIndex="1" InteractBlacklistTimeInSeconds="1" X="7443.989" Y="-535.682" Z="1896.85" />
		<TurnIn QuestName="Sibling Rivalry" QuestId="13064" TurnInName="Thorim" TurnInId="29445" X="7442.949" Y="-535.343" Z="1896.85" />

		<!-- <PickUp QuestName="Mending Fences" QuestId="12915" GiverName="Thorim" GiverId="29445" X="7442.949" Y="-535.343" Z="1896.85" /> Too Risky -->

		<Code File="KillUntilComplete" MobId="30046" QuestId="12968" X="7270.79" Y="139.5031" Z="784.6433" />

		<If Condition="NeedsQuest(12953)" >
			<MoveTo X="7318.019" Y="185.5724" Z="791.7702" />
			<PickUp Nav="Run" QuestName="Valkyrion Must Burn" QuestId="12953" GiverName="Harpoon Crate" GiverId="192072" X="7272.075" Y="136.4072" Z="784.6395" />
		</If>

		<While Condition="DoQuest(12925)" >
			<Code File="KillUntilComplete" MobId="29569" QuestId="12925" TerminateWhen="HasItem(41612)" >
				<HuntingGrounds>
					<Hotspot X="7387.25" Y="160.316" Z="771.6391" />
					<Hotspot X="7350.622" Y="64.47357" Z="768.001" />
					<Hotspot X="7253.573" Y="-2.860944" Z="772.6285" />
				</HuntingGrounds>
			</Code>
			<Code File="InteractWith" NonCompeteDistance="0" CollectionDistance="200" PreInteractMountStrategy="Dismount" InteractByUsingItemId="41612" QuestId="12925" X="7432.697" Y="187.2568" Z="768.6882" TerminateWhen="!HasItem(41612)" >
				<PursuitList>
					<PursueGameObject Id="191840" PursueWhen="GAMEOBJECT.State == WoWGameObjectState.Ready" />
				</PursuitList>
			</Code>
		</While>

		<Code File="KillUntilComplete" MobId="29570" QuestId="12942" >
			<HuntingGrounds>
				<Hotspot X="7350.213" Y="141.6237" Z="785.274" />
				<Hotspot X="7382.662" Y="284.75" Z="770.7054" />
				<Hotspot X="7335.617" Y="-36.24355" Z="768.7664" />
				<Hotspot X="7220.104" Y="-78.73867" Z="768.9071" />
			</HuntingGrounds>
		</Code>

		<While Condition="DoQuest(12953)" >
			<If Condition="!Me.InVehicle" >
				<MoveTo X="7351.228" Y="-100.6602" Z="777.6393" />
				<Code File="InteractWith" MobId="30066" NonCompeteDistance="5" CollectionDistance="5" QuestId="12953" X="7351.193" Y="-96.48249" Z="777.633" TerminateWhen="Me.InVehicle" />
			</If>
			<DisableBehavior Name="Combat" />
			<Code File="Vehicles\CannonControl" MobId="30096" VehicleId="30066" MinAngle="-0.78539997339249" MaxAngle="1.3090000152588" Buttons="1" Velocity="100" QuestId="12953" TerminateWhen="!Me.InVehicle || Me.Combat" />
			<Code File="EjectVeh" />
			<EnableBehavior Name="Combat" />
			<!-- 55934, aura the haystacks get when they are burning.  It would be nice if CannonControl allowed us to check stuff like this. -->
		</While>

		<If Condition="QuestDone(12942)" >
			<MoveTo X="6754.453" Y="-1623.896" Z="811.7469" /> <!-- To avoid an issue where the bot gets stuck trying to get on the building ledge. -->
			<TurnIn QuestName="Off With Their Black Wings" QuestId="12942" TurnInName="Iva the Vengeful" TurnInId="29997" X="6778.028" Y="-1599.225" Z="820.4236" />
		</If>
		<TurnIn QuestName="Yulda&apos;s Folly" QuestId="12968" TurnInName="Iva the Vengeful" TurnInId="29997" X="6778.028" Y="-1599.225" Z="820.4236" />
		<TurnIn QuestName="Valkyrion Must Burn" QuestId="12953" TurnInName="Iva the Vengeful" TurnInId="29997" X="6778.028" Y="-1599.225" Z="820.4236" />
		<TurnIn QuestName="Aberrations" QuestId="12925" TurnInName="Thyra Kvinnshal" TurnInId="30041" X="6778.028" Y="-1599.225" Z="820.4236" />
		<RecheckCheckpoints />

		<PickUp QuestName="The Witness and the Hero" QuestId="13034" GiverName="Xarantaur" GiverId="30381" X="7761.55" Y="-2833.271" Z="1216.73" />
		<Code File="InteractWith" MobId="192493" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" PreInteractMountStrategy="Dismount" QuestId="13034" QuestObjectiveIndex="1" X="7803.266" Y="-2840.165" Z="1219.131" />
		<Code File="InteractWith" MobId="192494" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" PreInteractMountStrategy="Dismount" QuestId="13034" QuestObjectiveIndex="2" X="7818.825" Y="-2910.941" Z="1241.735" />
		<Code File="InteractWith" MobId="192495" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" PreInteractMountStrategy="Dismount" QuestId="13034" QuestObjectiveIndex="3" X="7802.025" Y="-2959.574" Z="1259.261" />
		<TurnIn QuestName="The Witness and the Hero" QuestId="13034" TurnInName="Xarantaur" TurnInId="30381" X="7762.783" Y="-2832.951" Z="1216.729" />

		<PickUp QuestName="Memories of Stormhoof" QuestId="13037" GiverName="Xarantaur" GiverId="30381" X="7761.448" Y="-2833.708" Z="1216.729" />
		<While Condition="DoQuest(13037)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="8226.457" Y="-2602.728" Z="1150.102" />
			</If>
			<Code File="InteractWith" MobId="30395" GossipOptions="1" NonCompeteDistance="0" MovementBy="NavigatorOnly" QuestId="13037" X="8344.174" Y="-2512.531" Z="1147.749" />
			<Code File="WaitTimer" WaitTime="60000" QuestId="13037" />
		</While>

		<PickUp QuestName="Distortions in Time" QuestId="13038" GiverName="Chieftain Swiftspear" GiverId="30395" X="8344.174" Y="-2512.531" Z="1147.749" />

		<Code File="InteractWith" MobId="30446" Range="15" IgnoreLoSToTarget="true" CollectionDistance="200" InteractByUsingItemId="42781" MovementBy="NavigatorOnly" QuestId="13038" QuestObjectiveIndex="1" X="8292.924" Y="-2570.601" Z="1146.701" />

		<TurnIn QuestName="Memories of Stormhoof" QuestId="13037" TurnInName="Xarantaur" TurnInId="30381" X="7764.802" Y="-2832.036" Z="1216.73" />
		<TurnIn QuestName="Distortions in Time" QuestId="13038" TurnInName="Xarantaur" TurnInId="30381" X="7764.802" Y="-2832.036" Z="1216.73" />
		<PickUp QuestName="Where Time Went Wrong" QuestId="13048" GiverName="Xarantaur" GiverId="30381" X="7764.802" Y="-2832.036" Z="1216.73" />
		<PickUp QuestName="The Hero&apos;s Arms" QuestId="13049" GiverName="Xarantaur" GiverId="30381" X="7764.802" Y="-2832.036" Z="1216.73" />

		<While Condition="DoQuest(13048, 13049)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="8075.466" Y="-2925.276" Z="1137.163" />
			</If>
			<DefaultNavType Value="Run" />

			<Code File="InteractWith" MobIds="192541, 192542, 192543, 192544, 192545, 192546" CollectionDistance="200" InteractByLooting="true" MovementBy="NavigatorOnly" QuestId="13048" QuestObjectiveIndex="1" >
				<HuntingGrounds>
					<Hotspot X="8113.927" Y="-2978.396" Z="1127.935" />
					<Hotspot X="8187.027" Y="-3085.166" Z="1117.29" />
					<Hotspot X="8295.627" Y="-2983.987" Z="1075.649" />
					<Hotspot X="8227.54" Y="-2901.859" Z="1054.162" />
				</HuntingGrounds>
			</Code>

			<Code File="KillUntilComplete" MobId="30184" TerminateWhen="!DoQuest(13049) &amp;&amp; IsQuestCompleted(12882) ? true : GetItemCount(42780) &gt;= 10" >
				<HuntingGrounds>
					<Hotspot X="8113.927" Y="-2978.396" Z="1127.935" />
					<Hotspot X="8187.027" Y="-3085.166" Z="1117.29" />
					<Hotspot X="8295.627" Y="-2983.987" Z="1075.649" />
					<Hotspot X="8227.54" Y="-2901.859" Z="1054.162" />
				</HuntingGrounds>
			</Code>
		</While>

		<TurnIn QuestName="Where Time Went Wrong" QuestId="13048" TurnInName="Xarantaur" TurnInId="30381" X="7760.356" Y="-2830.321" Z="1216.73" />
		<TurnIn QuestName="The Hero&apos;s Arms" QuestId="13049" TurnInName="Xarantaur" TurnInId="30381" X="7760.356" Y="-2830.321" Z="1216.73" />

		<DefaultNavType Value="Fly" />

		<PickUp QuestName="Changing the Wind&apos;s Course" QuestId="13058" GiverName="Xarantaur" GiverId="30381" X="7760.356" Y="-2830.321" Z="1216.73" />
		<While Condition="DoQuest(13058)" >
			<Code File="InteractWith" MobId="194123" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" PreInteractMountStrategy="Dismount" QuestId="13058" QuestObjectiveIndex="1" X="7970.307" Y="-2752.958" Z="1137.355" TerminateWhen="Object(194123) == null" />
			<If Condition="!Me.InVehicle &amp;&amp; Object(194123) == null" >
				<MoveTo X="7917.796" Y="-2773.381" Z="1135.17" />
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="42918" QuestId="13058" X="7917.796" Y="-2773.381" Z="1135.17" />
			</If>

			<If Condition="Me.InVehicle" >
				<DisableBehavior Name="All" />
				<Code File="RunCode">
					<![CDATA[
						await Coroutine.Wait(5000, () => Unit(30474) != null);
						WoWUnit northWindPoi = Unit(30474);

						while (northWindPoi != null && Me.InVehicle)
						{
							if (Me.CurrentTarget != northWindPoi)
								northWindPoi.Target();
							while (northWindPoi.DistanceSqr > 5f*5f)
							{
								Navigator.MoveTo(northWindPoi.Location);
								await Coroutine.Yield();
							}
							if (Lua.GetReturnVal<bool>("return GetPetActionCooldown(2) == 0;", 0))
								Lua.DoString("CastPetAction(2);");
							if (Lua.GetReturnVal<bool>("return GetPetActionCooldown(1) == 0;", 0))
								Lua.DoString("CastPetAction(1);");
							await Coroutine.Yield();
						}
					]]>
				</Code>
				<Code File="EjectVeh" />
			</If>
			<EnableBehavior Name="All" />
		</While>
		<TurnIn QuestName="Changing the Wind&apos;s Course" QuestId="13058" TurnInName="Xarantaur" TurnInId="30381" X="7761.38" Y="-2834.018" Z="1216.73" />

		<PickUp QuestName="The Missing Tracker" QuestId="13054" GiverName="Blood Guard Lorga" GiverId="30247" X="7869.116" Y="-747.7384" Z="1176.774" />
		<PickUp QuestName="Emergency Measures" QuestId="13000" GiverName="Blood Guard Lorga" GiverId="30247" X="7869.116" Y="-747.7384" Z="1176.774" />
		<PickUp QuestName="Ancient Relics" QuestId="12882" GiverName="Olut Alegut" GiverId="30472" X="7847.222" Y="-787.6952" Z="1183.117" />

		<If Condition="QuestDone(12882)" >
			<TurnIn QuestName="Ancient Relics" QuestId="12882" TurnInName="Olut Alegut" TurnInId="30472" X="7847.222" Y="-787.6952" Z="1183.117" />
			<Code File="RunCode">
				<![CDATA[
					var whitelist = (List<uint>)AppDomain.CurrentDomain.GetData("QuestingProfiles_AFKModeWhitelist");
					if (whitelist.Contains(42780))
					{
						whitelist.Remove(42780);
						AppDomain.CurrentDomain.SetData("QuestingProfiles_AFKModeWhitelist", whitelist);
					}
				]]>
			</Code>
		</If>

		<PickUp QuestName="The Missing Bronzebeard" QuestId="12895" GiverName="Boktar Bloodfury" GiverId="29651" X="7843.097" Y="-808.0073" Z="1184.013" />

		<If Condition="!IsQuestCompleted(12929)" >
			<Code File="SetHearthstone" MobId="29944" AreaId="4429" X="7846.749" Y="-796.3998" Z="1183.98" />
		</If>

		<While Condition="!IsQuestCompleted(13056)" >
			<!-- Cave quests -->
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="7578.281" Y="-1482.608" Z="978.3488" />
			</If>
			<DefaultNavType Value="Run" />
			<TurnIn QuestName="The Missing Tracker" QuestId="13054" TurnInName="Tracker Val&apos;zij" TurnInId="30469" X="7622.498" Y="-1605.092" Z="969.969" />
			<PickUp QuestName="Cave Medicine" QuestId="13055" GiverName="Tracker Val&apos;zij" GiverId="30469" X="7621.811" Y="-1607.109" Z="969.576" />

			<Code File="InteractWith" MobId="192556" CollectionDistance="200" InteractByLooting="true" QuestId="13055" QuestObjectiveIndex="1" >
				<HuntingGrounds>
					<Hotspot X="7658.184" Y="-1612.692" Z="964.2017" />
					<Hotspot X="7878.258" Y="-1523.223" Z="923.4458" />
					<Hotspot X="7915.286" Y="-1620.909" Z="910.7279" />
					<Hotspot X="8001.668" Y="-1565.293" Z="904.257" />
				</HuntingGrounds>
			</Code>

			<Code File="KillUntilComplete" TerminateWhen="!DoQuest(13000) &amp;&amp; IsObjectiveComplete(2, 13055)" >
				<HuntingGrounds>
					<Hotspot X="7658.184" Y="-1612.692" Z="964.2017" />
					<Hotspot X="7878.258" Y="-1523.223" Z="923.4458" />
					<Hotspot X="7915.286" Y="-1620.909" Z="910.7279" />
					<Hotspot X="8001.668" Y="-1565.293" Z="904.257" />
				</HuntingGrounds>
				<PursuitList>
					<PursueUnit Id="30164" PursueWhen="DoQuest(13000)" />
					<PursueUnit Id="30148" PursueWhen="!IsObjectiveComplete(2, 13055)" />
				</PursuitList>
			</Code>

			<TurnIn QuestName="Cave Medicine" QuestId="13055" TurnInName="Tracker Val&apos;zij" TurnInId="30469" X="7619.821" Y="-1605.777" Z="969.795" />

			<PickUp QuestName="There&apos;s Always Time for Revenge" QuestId="13056" GiverName="Tracker Val&apos;zij" GiverId="30469" X="7619.821" Y="-1605.777" Z="969.795" />
			<Code File="KillUntilComplete" MobId="30167" QuestId="13056" >
				<HuntingGrounds>
					<Hotspot X="7654.195" Y="-1598.509" Z="967.3248" />
					<Hotspot X="7734.186" Y="-1640.204" Z="950.9694" />
					<Hotspot X="7825.988" Y="-1548.031" Z="933.5438" />
					<Hotspot X="7938.741" Y="-1591.219" Z="909.7537" />
				</HuntingGrounds>
			</Code>
			<TurnIn QuestName="There&apos;s Always Time for Revenge" QuestId="13056" TurnInName="Tracker Val&apos;zij" TurnInId="30469" X="7623.568" Y="-1608.623" Z="969.3176" />
			<DefaultNavType Value="Fly" />
		</While>

		<If Condition="QuestDone(13000) &amp;&amp; Me.HearthstoneAreaId == 4429 &amp;&amp; Unit(30469) != null" >
			<Code File="UseHearthstone" WaitForCd="false" />
			<!-- CHECK ME, for some reason 13000 is never turned in -->
		</If>

		<Code File="InteractWith" MobId="191708" InteractByLooting="true" InteractBlacklistTimeInSeconds="1" PreInteractMountStrategy="Dismount" QuestId="12895" QuestObjectiveIndex="1" X="7158.884" Y="-725.8159" Z="893.7598" />

		<TurnIn QuestName="The Missing Bronzebeard" QuestId="12895" TurnInName="Boktar Bloodfury" TurnInId="29651" X="7843.662" Y="-807.1531" Z="1184.099" />
		<PickUp QuestName="The Nose Knows" QuestId="12909" GiverName="Boktar Bloodfury" GiverId="29651" X="7843.662" Y="-807.1531" Z="1184.099" />
		<TurnIn QuestName="The Nose Knows" QuestId="12909" TurnInName="Khaliisi" TurnInId="29855" X="7766.061" Y="-1059.399" Z="928.2261" />
		<RecheckCheckpoints />

		<PickUp QuestName="Sniffing Out the Perpetrator" QuestId="12910" GiverName="Khaliisi" GiverId="29855" X="7766.061" Y="-1059.399" Z="928.2261" />
		<While Condition="DoQuest(12910)" >
			<Code File="InteractWith" MobId="29857" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" QuestId="12910" X="7765.788" Y="-1060.586" Z="928.2064" TerminateWhen="Me.InVehicle" />
			<DisableBehavior Name="All" />
			<Code File="RunCode" Code="
				while (DoQuest(12910) &amp;&amp; Me.InVehicle)
				{
					WoWUnit dwarfAgressor = ObjectManager.GetObjectsOfType&lt;WoWUnit&gt;().OrderBy(x =&gt; x.DistanceSqr).FirstOrDefault(x =&gt; (x.Entry == 29652 || x.Entry == 29696) &amp;&amp; x.IsAlive &amp;&amp; x.DistanceSqr &lt; 40f*40f);

					if (dwarfAgressor == null)
					{
						await Coroutine.Sleep(200);
						continue;
					}

					if (StyxWoW.Me.CurrentTarget != dwarfAgressor)
						dwarfAgressor.Target();

					if (dwarfAgressor.IsValid &amp;&amp; Lua.GetReturnVal&lt;bool&gt;(&quot;return GetPetActionCooldown(1) == 0;&quot;, 0))
					{
						Lua.DoString(&quot;CastPetAction(1);&quot;);
						await CommonCoroutines.SleepForRandomReactionTime();
					}
					if (dwarfAgressor.IsValid &amp;&amp; dwarfAgressor.DistanceSqr &lt; 30f*30f &amp;&amp; Lua.GetReturnVal&lt;bool&gt;(&quot;return GetPetActionCooldown(2) == 0;&quot;, 0))
					{
						Lua.DoString(&quot;CastPetAction(2);&quot;);
						SpellManager.ClickRemoteLocation(WoWMathHelper.CalculatePointInFront(dwarfAgressor.Location, dwarfAgressor.Rotation, 3));
						await CommonCoroutines.SleepForRandomReactionTime();
					}
					
					await Coroutine.Sleep(200);
				}
			" /> <!-- HB-API is returning incorrect values, so using Lua.-->
			<EnableBehavior Name="All" />
			<Code File="WaitTimer" WaitTime="5000" QuestId="12910" QuestObjectiveIndex="1" />
			<Code File="KillUntilComplete" MobId="29695" QuestId="12910" QuestObjectiveIndex="2" X="7309.517" Y="-1588.412" Z="942.8536" />
		</While>

		<If Condition="QuestDone(12910)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<TurnIn QuestName="Sniffing Out the Perpetrator" QuestId="12910" TurnInName="Brann Bronzebeard" TurnInId="29579" X="7309.517" Y="-1588.412" Z="942.8536" />
		</If>
		<If Condition="NeedsQuest(12913)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<PickUp QuestName="Speak Orcish, Man!" QuestId="12913" GiverName="Brann Bronzebeard" GiverId="29579" X="7309.835" Y="-1591.255" Z="942.7957" />
		</If>

		<TurnIn QuestName="Speak Orcish, Man!" QuestId="12913" TurnInName="Moteha Windborn " TurnInId="29937" X="7842.284" Y="-814.6086" Z="1183.9" />

		<PickUp QuestName="Speaking with the Wind&apos;s Voice" QuestId="12917" GiverName="Moteha Windborn " GiverId="29937" X="7842.284" Y="-814.6086" Z="1183.9" />
		<Code File="KillUntilComplete" MobId="29624" QuestId="12917" >
			<HuntingGrounds>
				<Hotspot X="7884.06" Y="-448.2509" Z="900.5056" />
				<Hotspot X="7877.002" Y="-282.3752" Z="880.9742" />
				<Hotspot X="7929.168" Y="-157.2922" Z="867.5833" />
				<Hotspot X="8063.918" Y="-102.8812" Z="862.1285" />
				<Hotspot X="8175.212" Y="-70.12145" Z="851.2628" />
			</HuntingGrounds>
		</Code>
		<TurnIn QuestName="Speaking with the Wind&apos;s Voice" QuestId="12917" TurnInName="Moteha Windborn " TurnInId="29937" X="7842.786" Y="-806.6572" Z="1183.898" />

		<PickUp QuestName="Catching up with Brann" QuestId="12920" GiverName="Boktar Bloodfury" GiverId="29651" X="7842.786" Y="-806.6572" Z="1183.898" />
		<While Condition="DoQuest(12920)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<Code File="InteractWith" MobId="29579" GossipOptions="1" QuestId="12920" />
			<Code File="WaitTimer" WaitTime="90000" QuestId="29579" />
		</While>
		<TurnIn QuestName="Catching up with Brann" QuestId="12920" TurnInName="Boktar Bloodfury" TurnInId="29651" X="7842.786" Y="-806.6572" Z="1183.898" />
		<RecheckCheckpoints />

		<PickUp QuestName="Pieces of the Puzzle" QuestId="12926" GiverName="Boktar Bloodfury" GiverId="29651" X="7842.786" Y="-806.6572" Z="1183.898" />

		<While Condition="DoQuest(12926)" >
			<Code File="KillUntilComplete" MobId="29724" QuestId="12926" TerminateWhen="GetItemCount(41130) &gt;= 6" >
				<HuntingGrounds>
					<Hotspot X="8159.566" Y="-825.7995" Z="955.6598" />
					<Hotspot X="8114.177" Y="-917.3442" Z="955.7963" />
					<Hotspot X="8262.729" Y="-821.7173" Z="923.8743" />
					<Hotspot X="8252" Y="-976.6149" Z="923.875" />
				</HuntingGrounds>
			</Code>
			<Code File="UseItem" ItemId="41130" QuestId="12926" TerminateWhen="!HasItem(41130)" />
		</While>
		<If Condition="QuestDone(12926)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<TurnIn QuestName="Pieces to the Puzzle" QuestId="12926" TurnInName="Brann Bronzebeard" TurnInId="29579" X="8080.941" Y="-842.9305" Z="971.7382" />
		</If>

		<If Condition="NeedsQuest(12927)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<PickUp QuestName="Data Mining" QuestId="12927" GiverName="Brann Bronzebeard" GiverId="29579" />
		</If>

		<Code File="InteractWith" MobId="29746" InteractByUsingItemId="41179" WaitTime="10000" PreInteractMountStrategy="Dismount" CollectionDistance="200" QuestId="12927" QuestObjectiveIndex="1" >
			<HuntingGrounds>
				<Hotspot X="8159.566" Y="-825.7995" Z="955.6598" />
				<Hotspot X="8114.177" Y="-917.3442" Z="955.7963" />
				<Hotspot X="8262.729" Y="-821.7173" Z="923.8743" />
				<Hotspot X="8252" Y="-976.6149" Z="923.875" />
			</HuntingGrounds>
		</Code>

		<If Condition="QuestDone(12927)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<TurnIn QuestName="Data Mining" QuestId="12927" TurnInName="Brann Bronzebeard" TurnInId="29579" />
		</If>

		<If Condition="NeedsQuest(13416)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<PickUp QuestName="The Library Console" QuestId="13416" GiverName="Brann Bronzebeard" GiverId="29579" />
		</If>

		<If Condition="QuestDone(13416)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="8064.536" Y="-843.2484" Z="971.7408" />
			</If>
			<MoveTo Nav="Run" X="7981.323" Y="-821.4858" Z="968.2516" />
		</If>
		<TurnIn QuestName="The Library Console" QuestId="13416" TurnInName="Inventor&apos;s Library Console" TurnInId="191760" X="7981.323" Y="-821.4858" Z="968.2516" />

		<PickUp QuestName="Norgannon&apos;s Shell" QuestId="12928" GiverName="Inventor&apos;s Library Console" GiverId="191760" X="7981.657" Y="-821.636" Z="968.2505" />
		<While Condition="DoQuest(12928)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="8064.536" Y="-843.2484" Z="971.7408" />
			</If>
			<MoveTo X="7982.994" Y="-821.3993" Z="968.2505" />
			<Code File="UseItem" ItemId="44704" QuestId="12928" TerminateWhen="Unit(29775) != null" />
			<Code File="KillUntilComplete" MobId="29775" QuestId="12928" X="7984.616" Y="-822.129" Z="968.1806" TerminateWhen="Unit(29775) == null" />
		</While>
		<If Condition="QuestDone(12928)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<TurnIn QuestName="Norgannon&apos;s Shell" QuestId="12928" TurnInName="Brann Bronzebeard" TurnInId="29579" />
		</If>

		<If Condition="NeedsQuest(13273, 12929)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<PickUp QuestName="Going After the Core" QuestId="13273" GiverName="Brann Bronzebeard" GiverId="29579" X="7984.273" Y="-821.9825" Z="968.1807" />
			<PickUp QuestName="The Earthen of Ulduar" QuestId="12929" GiverName="Brann Bronzebeard" GiverId="29579" X="7984.273" Y="-821.9825" Z="968.1807" />
		</If>

		<Code File="InteractWith" MobId="193560" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" PreInteractMountStrategy="Dismount" QuestId="13273" QuestObjectiveIndex="2" X="7759.007" Y="-2371.342" Z="1076.328" />
		<Code File="InteractWith" MobId="193561" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" PreInteractMountStrategy="Dismount" QuestId="13273" QuestObjectiveIndex="1" X="7703.964" Y="-2411.305" Z="1079.345" />

		<If Condition="QuestDone(13273)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<TurnIn QuestName="Going After the Core" QuestId="13273" TurnInName="Brann Bronzebeard" TurnInId="29579" />
		</If>

		<PickUp QuestName="The Core&apos;s Keeper" QuestId="13274" GiverName="Brann Bronzebeard" GiverId="29579" X="7724.798" Y="-2395.958" Z="1092.412" />
		<While Condition="DoQuest(13274)" >
			<If Condition="Unit(31798) == null" >
				<Code File="FlyTo" X="7415.895" Y="-2188.1" Z="956.7578" />
				<Code File="MyCTM" X="7471.534" Y="-2056.066" Z="911.3531" />
				<Code File="MyCTM" X="7487.709" Y="-2060.65" Z="880.525" />
				<Code File="MyCTM" X="7604.429" Y="-2112.145" Z="798.1376" />
				<Code File="MyCTM" X="7711.892" Y="-2161.435" Z="786.3672" />
			</If>
			<Code File="KillUntilComplete" MobId="31798" QuestId="13274" X="7711.892" Y="-2161.435" Z="786.3672" />
		</While>

		<If Condition="QuestDone(13274)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<TurnIn QuestName="The Core&apos;s Keeper" QuestId="13274" TurnInName="Brann Bronzebeard" TurnInId="29579" />
		</If>

		<If Condition="NeedsQuest(13285)" >
			<If Condition="Unit(29579) == null" >
				<Code File="ForcedDismount" />
				<Code File="UseItem" ItemId="40971" TerminateWhen="Unit(29579) != null" />
			</If>
			<PickUp QuestName="Forging the Keystone" QuestId="13285" GiverName="Brann Bronzebeard" GiverId="29579" />
		</If>

		<If Condition="DistanceTo(7711.892f, -2161.435f, 786.3672f) &lt;= 200" >
			<If Condition="Me.HearthstoneAreaId == 4429" >
				<Code File="UseHearthstone" WaitForCD="false" />
			</If>
			<If Condition="DistanceTo(7711.892f, -2161.435f, 786.3672f) &lt;= 200" >
				<While Condition="!Me.Mounted" >
					<Code File="ForcedMount" MountType="Flying" />
				</While>
				<Code File="MyCTM" X="7590.358" Y="-2105.252" Z="803.7235" />
				<Code File="MyCTM" X="7460.184" Y="-2046.64" Z="901.61" />
				<Code File="MyCTM" X="7411.363" Y="-2224.485" Z="973.176" />
			</If>
		</If>

		<While Condition="DoQuest(13285)" >
			<MoveTo X="7845.778" Y="-1394.503" Z="1534.059" />
			<Code File="InteractWith" MobId="31810" GossipOptions="1" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" QuestId="13285" QuestObjectiveIndex="1" X="7845.778" Y="-1394.503" Z="1534.059" />
		</While>

		<TurnIn QuestName="Forging the Keystone" QuestId="13285" TurnInName="Boktar Bloodfury" TurnInId="29651" X="7842.284" Y="-815.175" Z="1183.917" />
		<TurnIn QuestName="The Earthen of Ulduar" QuestId="12929" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8395.917" Y="-389.077" Z="902.9912" />

		<Code File="SetHearthstone" MobId="29963" AreaId="4484" X="8426.41" Y="-355.5836" Z="906.4028" />


		<PickUp QuestName="Rare Earth" QuestId="12930" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8395.884" Y="-389.2248" Z="902.9908" />
		<If Condition="!QuestDone(12930)" > <!-- Protect Frostweave Cloth from the AFK Mode sell logic -->
			<Code File="RunCode">
				<![CDATA[
					var whitelist = (List<uint>)AppDomain.CurrentDomain.GetData("QuestingProfiles_AFKModeWhitelist");
					whitelist.Add(33470);
					AppDomain.CurrentDomain.SetData("QuestingProfiles_AFKModeWhitelist", whitelist);
				]]>
			</Code>
		</If>
		<While Condition="DoQuest(12930)" >
			<Code File="InteractWith" MobIds="191844, 191845" InteractByLooting="true" PreInteractMountStrategy="Dismount" Range="2" CollectionDistance="200" QuestId="12930" QuestObjectiveIndex="1" >
				<HuntingGrounds>
					<Hotspot X="8546.375" Y="-261.2175" Z="807.3447" />
					<Hotspot X="8656.159" Y="-244.2761" Z="562.3036" />
					<Hotspot X="8623.55" Y="8.673094" Z="542.0881" />
					<Hotspot X="8577.074" Y="126.0489" Z="693.0005" />
				</HuntingGrounds>
			</Code>
			<Code File="KillUntilComplete" MobId="29377" QuestId="12930" TerminateWhen="GetItemCount(33470) &gt;= 5" >
				<HuntingGrounds>
					<Hotspot X="8379.331" Y="-161.3644" Z="825.9949" />
					<Hotspot X="8365.812" Y="-47.10135" Z="811.0393" />
					<Hotspot X="8488.363" Y="-27.91723" Z="785.5683" />
					<Hotspot X="8489.271" Y="-168.5402" Z="804.2169" />
				</HuntingGrounds>
			</Code>
		</While>
		<TurnIn QuestName="Rare Earth" QuestId="12930" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8394.814" Y="-390.0124" Z="902.9807" />
		<RecheckCheckpoints />

		<PickUp QuestName="Fighting Back" QuestId="12931" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8394.814" Y="-390.0124" Z="902.9807" />
		<PickUp QuestName="Relief for the Fallen" QuestId="12937" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8394.814" Y="-390.0124" Z="902.9807" />

		<Code File="SetHearthstone" MobId="29963" AreaId="4484" X="8426.41" Y="-355.5836" Z="906.4028" />

		<Code File="InteractWith" MobId="30035" InteractByUsingItemId="41988" PreInteractMountStrategy="Dismount" CollectionDistance="200" QuestId="12937" QuestObjectiveIndex="1" >
			<HuntingGrounds>
				<Hotspot X="8380.605" Y="-158.8937" Z="824.3897" />
				<Hotspot X="8378.187" Y="-25.35641" Z="805.2668" />
				<Hotspot X="8423.299" Y="101.2115" Z="795.588" />
			</HuntingGrounds>
		</Code>

		<Code File="KillUntilComplete" MobId="29382" QuestId="12931" >
			<HuntingGrounds>
				<Hotspot X="8380.605" Y="-158.8937" Z="824.3897" />
				<Hotspot X="8378.187" Y="-25.35641" Z="805.2668" />
				<Hotspot X="8423.299" Y="101.2115" Z="795.588" />
			</HuntingGrounds>
		</Code>

		<TurnIn QuestName="Fighting Back" QuestId="12931" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8394.384" Y="-390.727" Z="903.025" />
		<TurnIn QuestName="Relief for the Fallen" QuestId="12937" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8394.384" Y="-390.727" Z="903.025" />
		<RecheckCheckpoints />
		<PickUp QuestName="Slaves of the Stormforged" QuestId="12957" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8394.384" Y="-390.727" Z="903.025" />
		<PickUp QuestName="The Dark Ore" QuestId="12964" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8394.384" Y="-390.727" Z="903.025" />

		<While Condition="DoQuest(12964)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="7846.557" Y="-114.1202" Z="882.9071" />
			</If>
			<Code File="InteractWith" MobId="192058" MovementBy="NavigatorOnly" InteractByLooting="true" CollectionDistance="200" PreInteractMountStrategy="Dismount" QuestId="12964" QuestObjectiveIndex="1" >
				<HuntingGrounds>
					<Hotspot X="7838.968" Y="-105.5712" Z="882.4541" />
					<Hotspot X="7824.937" Y="-41.1665" Z="882.6467" />
					<Hotspot X="7733.886" Y="-21.98413" Z="867.1586" />
				</HuntingGrounds>
			</Code>
		</While>

		<While Condition="DoQuest(12957)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="7846.557" Y="-114.1202" Z="882.9071" />
			</If>
			<Code File="InteractWith" MobId="29384" MovementBy="NavigatorOnly" GossipOptions="1" CollectionDistance="200" PreInteractMountStrategy="Dismount" QuestId="12957" QuestObjectiveIndex="1" >
				<HuntingGrounds>
					<Hotspot X="7838.968" Y="-105.5712" Z="882.4541" />
					<Hotspot X="7824.937" Y="-41.1665" Z="882.6467" />
					<Hotspot X="7733.886" Y="-21.98413" Z="867.1586" />
				</HuntingGrounds>
			</Code>

			<Code File="KillUntilComplete" MobId="29369" QuestId="12957" QuestObjectiveIndex="2" >
				<HuntingGrounds>
					<Hotspot X="7838.968" Y="-105.5712" Z="882.4541" />
					<Hotspot X="7824.937" Y="-41.1665" Z="882.6467" />
					<Hotspot X="7733.886" Y="-21.98413" Z="867.1586" />
				</HuntingGrounds>
			</Code>
		</While>

		<If Condition="QuestDone(12964, 12957) &amp;&amp; Me.HearthstoneAreaId == 4484 &amp;&amp; (Unit(29384) != null || Object(192058) != null)" >
			<Code File="UseHearthstone" WaitForCD="false" />
		</If>

		<TurnIn QuestName="Slaves of the Stormforged" QuestId="12957" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8394.17" Y="-391.1158" Z="903.0861" />
		<TurnIn QuestName="The Dark Ore" QuestId="12964" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8394.17" Y="-391.1158" Z="903.0861" />
		<RecheckCheckpoints />
		<PickUp QuestName="The Gifts of Loken" QuestId="12965" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8394.17" Y="-391.1158" Z="903.0861" />
		<PickUp QuestName="Facing the Storm" QuestId="12978" GiverName="Bruor Ironbane" GiverId="30152" X="8390.302" Y="-383.283" Z="903.1199" />

		<Code File="InteractWith" MobId="192120" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" QuestId="12965" QuestObjectiveIndex="1" X="8175.625" Y="130.6254" Z="897.9413" />
		<Code File="InteractWith" MobId="192121" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" QuestId="12965" QuestObjectiveIndex="2" X="7938.442" Y="-17.97992" Z="959.782" />
		<Code File="InteractWith" MobId="192122" NonCompeteDistance="0" InteractBlacklistTimeInSeconds="1" QuestId="12965" QuestObjectiveIndex="3" X="7903.688" Y="95.70469" Z="1029.867" />

		<Code File="KillUntilComplete" MobIds="29370, 29380" TerminateWhen="!DoQuest(12978) &amp;&amp; IsQuestCompleted(12979)" >
			<HuntingGrounds>
				<Hotspot X="7972.195" Y="96.68382" Z="1028.031" />
				<Hotspot X="8092.806" Y="19.18379" Z="893.9586" />
			</HuntingGrounds>
		</Code>

		<TurnIn QuestName="The Gifts of Loken" QuestId="12965" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8395.063" Y="-390.5228" Z="902.9797" />
		<TurnIn QuestName="Facing the Storm" QuestId="12978" TurnInName="Bruor Ironbane" TurnInId="30152" X="8390.035" Y="-385.0488" Z="903.1194" />
		<TurnIn QuestName="Armor of Darkness" QuestId="12979" TurnInName="Bruor Ironbane" TurnInId="30152" X="8390.035" Y="-385.0488" Z="903.1194" />
		<RecheckCheckpoints />

		<PickUp QuestName="The Armor&apos;s Secrets" QuestId="12980" GiverName="Bruor Ironbane" GiverId="30152" X="8390.035" Y="-385.0488" Z="903.1194" />
		<While Condition="DoQuest(12980)" >
			<If Condition="DistanceTo(8263.426f, -440.3163f, 970.5511f) &gt; 110" >
				<MoveTo X="8323.569" Y="-553.0508" Z="982.0056" />
			</If>
			<Code File="InteractWith" MobId="30190" NonCompeteDistance="0" MovementBy="NavigatorOnly" GossipOptions="1" QuestId="12980" QuestObjectiveIndex="1" X="8266.607" Y="-441.3017" Z="970.5823" />
		</While>
		<If Condition="QuestDone(12980)" >
			<If Condition="Me.IsIndoors &amp;&amp; Unit(30190) != null" >
				<MoveTo X="8346.521" Y="-562.4817" Z="982.0053" />
			</If>
			<TurnIn QuestName="The Armor&apos;s Secrets" QuestId="12980" TurnInName="Bruor Ironbane" TurnInId="30152" X="8392.438" Y="-382.4046" Z="903.049" />
		</If>

		<PickUp QuestName="Valduran the Stormborn" QuestId="12984" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8393.507" Y="-389.4008" Z="903.0486" />
		<While Condition="DoQuest(12984)" >
			<If Condition="!Me.IsIndoors" >
				<MoveTo X="7748.595" Y="81.65645" Z="1009.344" />
			</If>
			<Code File="UseItem" ItemId="42419" X="7727.51" Y="110.7957" Z="1010.636" TerminateWhen="Unit(29368, u =&gt; u.Attackable) != null" />
			<Code File="WaitTimer" WaitTime="35000" TerminateWhen="Unit(29368, u =&gt; u.Attackable) != null" />
			<Code File="KillUntilComplete" MobId="29368" QuestId="12984" X="7728.222" Y="111.3714" Z="1010.636" TerminateWhen="Unit(29368, u =&gt; !u.Attackable) != null" />
		</While>

		<If Condition="QuestDone(12984) &amp;&amp; Me.HearthstoneAreaId == 4484 &amp;&amp; Unit(29368) != null" >
			<Code File="UseHearthstone" WaitForCD="false" />
		</If>

		<If Condition="QuestDone(12984)" >
			<MoveTo X="8395.063" Y="-390.5228" Z="902.9797" />
			<TurnIn QuestName="Valduran the Stormborn" QuestId="12984" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8395.063" Y="-390.5228" Z="902.9797" />
		</If>
		<PickUp QuestName="Destroy the Forges!" QuestId="12988" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8395.063" Y="-390.5228" Z="902.9797" />
		<PickUp QuestName="Hit Them Where it Hurts" QuestId="12991" GiverName="Bruor Ironbane" GiverId="30152" X="8392.292" Y="-383.4521" Z="902.9904" />

		<While Condition="DoQuest(12988)" >
			<If Condition="!IsObjectiveComplete(1, 12988)" >
				<MoveTo X="8029.706" Y="-223.4491" Z="847.4165" />
				<Code File="ForcedDismount" />
				<Code File="UseItemTargetLocation" MobId="30209" ItemId="42441" UseType="PointToPoint" QuestId="12988" QuestObjectiveIndex="1" X="8028.472" Y="-224.8431" Z="847.4593" ClickToX="8024.174" ClickToY="-220.2057" ClickToZ="849.3782" />
			</If>
			<If Condition="!IsObjectiveComplete(2, 12988)" >
				<MoveTo X="8023.826" Y="-253.1086" Z="847.2867" />
				<Code File="ForcedDismount" />
				<Code File="UseItemTargetLocation" MobId="30211" ItemId="42441" UseType="PointToPoint" QuestId="12988" QuestObjectiveIndex="2" X="8023.826" Y="-253.1086" Z="847.2867" ClickToX="8021.413" ClickToY="-259.1406" ClickToZ="848.4938" />
			</If>
			<If Condition="!IsObjectiveComplete(3, 12988)" >
				<MoveTo X="8009.348" Y="-304.9648" Z="848.0046" />
				<Code File="ForcedDismount" />
				<Code File="UseItemTargetLocation" MobId="30212" ItemId="42441" UseType="PointToPoint" QuestId="12988" QuestObjectiveIndex="3" X="8009.348" Y="-304.9648" Z="848.0046" ClickToX="8009.648" ClickToY="-309.9774" ClickToZ="850.0353"  />
			</If>
		</While>

		<Code File="KillUntilComplete" MobId="29376" QuestId="12991" >
			<HuntingGrounds>
				<Hotspot X="8081.031" Y="-250.1976" Z="857.039" />
				<Hotspot X="7998.124" Y="-291.723" Z="847.2338" />
			</HuntingGrounds>
		</Code>

		<If Condition="QuestDone(12988, 12991) &amp;&amp; Me.HearthstoneAreaId == 4484 &amp;&amp; Unit(29376) != null" >
			<Code File="UseHearthstone" WaitForCD="false" />
		</If>

		<TurnIn QuestName="Destroy the Forges!" QuestId="12988" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8395.674" Y="-390.583" Z="902.9803" />
		<TurnIn QuestName="Hit Them Where it Hurts" QuestId="12991" TurnInName="Bruor Ironbane" TurnInId="30152" X="8389.688" Y="-384.375" Z="903.1195" />
		<RecheckCheckpoints />

		<PickUp QuestName="A Colossal Threat" QuestId="12993" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8395.104" Y="-390.0906" Z="902.981" />
		<Code File="InteractWith" MobId="192171" InteractByLooting="true" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" QuestId="12993" QuestObjectiveIndex="1" X="8106.906" Y="-213.0181" Z="848.1974" />
		<Code File="InteractWith" MobId="192172" InteractByLooting="true" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" QuestId="12993" QuestObjectiveIndex="2" X="8025.706" Y="-285.2402" Z="849.0407" />
		<TurnIn QuestName="A Colossal Threat" QuestId="12993" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8395.735" Y="-389.2541" Z="902.9891" />

		<PickUp QuestName="The Heart of the Storm" QuestId="12998" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8395.735" Y="-389.2541" Z="902.9891" />
		<While Condition="DoQuest(12998)" >
			<If Condition="DoQuest(12998) &amp;&amp; Unit(29801) != null" >
				<Code File="FlyTo" X="8494.334" Y="-374.1659" Z="946.7888" />
			</If>
			<If Condition="Object(192181) == null" >
				<Code File="FlyTo" X="7155.379" Y="-463.5214" Z="954.6254" />
				<Code File="MyCTM" X="7234.437" Y="-460.9258" Z="954.8806" />
				<Code File="MyCTM" X="7310.001" Y="-454.9555" Z="900.7285" />
				<Code File="MyCTM" X="7308.646" Y="-596.1565" Z="785.4083" />
				<Code File="MyCTM" X="7309.023" Y="-724.2565" Z="791.6111" />
			</If>
			<Code File="InteractWith" MobId="192181" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" QuestId="12998" QuestObjectiveIndex="1" X="7309.023" Y="-724.2565" Z="791.6111" />
		</While>

		<If Condition="DistanceTo(7309.333f, -721.2963f, 791.6102f) &lt;= 200" >
			<If Condition="Me.HearthstoneAreaId == 4484" >
				<Code File="UseHearthstone" WaitForCD="false" />
			</If>
			<If Condition="DistanceTo(7309.333f, -721.2963f, 791.6102f) &lt;= 200" >
				<While Condition="!Me.Mounted" >
					<Code File="ForcedMount" MountType="Flying" />
				</While>
				<Code File="MyCTM" X="7309.042" Y="-461.2775" Z="840.0389" />
				<Code File="MyCTM" X="7284.261" Y="-456.2398" Z="922.5925" />
				<Code File="MyCTM" X="7143.712" Y="-466.6248" Z="968.8696" />
				<Code File="MyCTM" X="7144.932" Y="-547.6667" Z="997.8606" /> <!-- Final pull away from the entrance so the bot doesn't fly back in -->
			</If>
		</If>

		<TurnIn QuestName="The Heart of the Storm" QuestId="12998" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8394.995" Y="-390.0541" Z="902.9816" />

		<PickUp QuestName="The Iron Colossus" QuestId="13007" GiverName="Bouldercrag the Rockshaper" GiverId="29801" X="8394.995" Y="-390.0541" Z="902.9816" />
		<While Condition="DoQuest(13007)" >
			<Code File="InteractWith" MobId="192262" NonCompeteDistance="0" PreInteractMountStrategy="Dismount" InteractBlacklistTimeInSeconds="1" QuestId="13007" X="8492.197" Y="-91.09685" Z="788.5424" TerminateWhen="Me.InVehicle" />
			<DisableBehavior Name="All" />
			<Code File="RunCode"><![CDATA[ TreeHooks.Instance.InsertHook("Questbot_Main", 0, _theironcolossus ?? (_theironcolossus = new  CommonBehaviors.Actions.ActionRunCoroutine(ctx => TheIronColossusTask()))); ]]></Code>
			<Code File="RunCode" Type="Definition" >
				<![CDATA[
					private Styx.TreeSharp.Composite _theironcolossus;
					private bool _needstoSubmerge = false;
					private bool _needstoEmerge = false;
					private readonly Vector3 _colossusspawnLocation = new Vector3(8250.302f, -87.07245f, 841.5595f);
					private Vector3 _behindcolossusLocation = new Vector3(0f, 0f, 0f);
					private WoWUnit _colossusPoi = null;
					private WoWUnit _jormungarPoi = null;

					private async Task<bool> TheIronColossusTask()
					{
						if (_colossusPoi != null && _colossusPoi.IsDead)
							_colossusPoi = null;

						if (_jormungarPoi != null && _jormungarPoi.IsDead)
							_jormungarPoi = null;

						if (!Me.InVehicle) return false;
						if (!DoQuest(13007)) 
						{
							if (Me.InVehicle)
								Lua.DoString("VehicleExit");
							return false;
						}

						if (_needstoSubmerge && !_jormungarPoi.HasAura(56512))
						{
							_needstoSubmerge = false;
							Lua.DoString("CastPetAction(1);");
						}

						if (_needstoEmerge && _jormungarPoi.HasAura(56512))
						{
							_needstoEmerge = false;
							Lua.DoString("CastPetAction(1);");
						}

						if (_colossusPoi == null || !_colossusPoi.IsValid)
							_colossusPoi = ObjectManager.GetObjectsOfType<WoWUnit>().FirstOrDefault(x => x.Entry == 30300 && x.IsAlive);

						if (_jormungarPoi == null || !_jormungarPoi.IsValid)
							_jormungarPoi = ObjectManager.GetObjectsOfType<WoWUnit>().FirstOrDefault(x => x.Entry == 30301 && x.CreatedByUnit == Me);

						if (_colossusPoi == null && !Navigator.AtLocation(_colossusspawnLocation))
						{
							TreeRoot.StatusText = "Moving to Colossus spawn location";
							_needstoSubmerge = true;
							return (await CommonCoroutines.MoveTo(_colossusspawnLocation)).IsSuccessful();
						}

						if (_colossusPoi.DistanceSqr > 35f*35f)
						{
							TreeRoot.StatusText = "Engaging Colossus";
							_needstoSubmerge = true;
							return (await CommonCoroutines.MoveTo(_colossusPoi.Location)).IsSuccessful();
						}

						if (_colossusPoi.CastingSpellId == 61673)
						{
							TreeRoot.StatusText = "Moving away from Colossus slam";
							_behindcolossusLocation = WoWMathHelper.CalculatePointBehind(_colossusPoi.Location, _colossusPoi.Rotation, 30);
							if (Me.Location.DistanceSqr(_behindcolossusLocation) > 10f*10f);
							{
								_needstoSubmerge = true;
								return (await CommonCoroutines.MoveTo(_behindcolossusLocation)).IsSuccessful();
							}
						}

						if (_colossusPoi.IsAlive)
						{
							await CommonCoroutines.StopMoving();
							_needstoEmerge = true;
							Me.SetFacing(_colossusPoi.Location);
							if (Me.CurrentTarget == null || Me.CurrentTarget.Entry != _colossusPoi.Entry)
								_colossusPoi.Target();
							Lua.DoString("if GetPetActionCooldown(3) == 0 then CastPetAction(3) else CastPetAction(2) end");
							return true;
						}

						return true;						
					}
				]]>
			</Code>

			<Code File="WaitTimer" WaitTime="10000" QuestId="13007" />
			<EnableBehavior Name="All" />

			<If Condition="QuestDone(13007)" >
				<Code File="RunCode"><![CDATA[ TreeHooks.Instance.RemoveHook("Questbot_Main", _theironcolossus); ]]></Code>
				<Code File="EjectVeh" />
			</If>
		</While>
		<TurnIn QuestName="The Iron Colossus" QuestId="13007" TurnInName="Bouldercrag the Rockshaper" TurnInId="29801" X="8395.649" Y="-388.9846" Z="902.9903" />

		<Checkpoint Level="80" /> <!-- 80+ is loaded in the Icecrown profile, this is just here to make the bot skip everything for quicker loads. -->

		<Code File="LoadProfile" ProfileName="Icecrown.xml" />

	</QuestOrder>
</HBProfile>